<!DOCTYPE html>
<html style="height: 100%">
<body style="height: 100%; overflow: hidden;">

<h1>Web Browser Controls</h1>
<div id="debug"></div>

<!-- horizon -->
<div style="
  position: fixed;
  top: -50%; left: -50%;
  height: 200%; width: 200%;
  z-index: -1;
">

  <div id="horizon" style="
    width: 100%;
    height: 100%;
    background-image: url(/files/horizon.png);
    background-repeat: no-repeat;
    background-size: cover;
    transform: rotate(0deg);
  ">&nbsp;</div>
  
</div>

<!-- steering wheel -->
<div style="
  width: 100%;
  height: 100%;
  background-image: url(/files/steering_wheel.png);
  background-repeat: no-repeat;
  background-size: cover;
">&nbsp;</div>

<script>
const ACCEL_G = 9.81;
const SPEED = 20;

var tilt_ratio = 0;

var horizon = document.getElementById("horizon");
var debug   = document.getElementById("debug");

if (debug) debug.innerHTML = "testing...";

window.ondevicemotion = function(event) {
  if (debug) debug.innerHTML = `ondevicemotion: ${tilt_ratio}`;
  tilt_ratio = -event.accelerationIncludingGravity.y / ACCEL_G;
};

/* update display */
setInterval(function() {
  let rotation =  Math.asin( tilt_ratio )/Math.PI*180;
  horizon.style.transform = `rotate(${rotation}deg)`;
}, 100);

/* update rover */
setInterval(function() {
  let left_speed =  Math.round( SPEED * (1 + tilt_ratio) );
  let right_speed = Math.round( SPEED * (1 - tilt_ratio) );

	var xhttp = new XMLHttpRequest();
	xhttp.onreadystatechange = function() {

		if (this.readyState == 4 && this.status == 200) {
		}
	};
	xhttp.open("GET", `/set_speed?left_speed=${left_speed}&right_speed=${right_speed}`, true);
	xhttp.send();
}, 100)


</script>

</body>
</html>
